<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ PWA</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #1a1a2e; }
        .check-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #ccc;
        }
        .check-item.success {
            background: #d4edda;
            border-color: #28a745;
        }
        .check-item.error {
            background: #f8d7da;
            border-color: #dc3545;
        }
        .check-item.warning {
            background: #fff3cd;
            border-color: #ffc107;
        }
        .check-item h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        .check-item p {
            margin: 5px 0;
            font-size: 14px;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        button {
            padding: 10px 20px;
            margin: 10px 5px;
            background: #e94560;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #d63954; }
        .actions {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ PWA</h1>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA.</p>
        
        <div id="checks"></div>
        
        <div class="actions">
            <h2>–î–µ–π—Å—Ç–≤–∏—è</h2>
            <button onclick="location.reload()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</button>
            <button onclick="window.location.href='create-icons-simple.html'">üì± –°–æ–∑–¥–∞—Ç—å –∏–∫–æ–Ω–∫–∏</button>
            <button onclick="window.location.href='index.html'">üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é</button>
        </div>
    </div>

    <script>
        const checks = [];
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: HTTPS –∏–ª–∏ localhost
        function checkHTTPS() {
            const isSecure = location.protocol === 'https:' || 
                           location.hostname === 'localhost' || 
                           location.hostname === '127.0.0.1' ||
                           location.hostname === '';
            const isLocalIP = /^192\.168\.|^10\.|^172\.(1[6-9]|2[0-9]|3[0-1])\./.test(location.hostname);
            
            if (isSecure) {
                checks.push({
                    title: 'HTTPS –∏–ª–∏ localhost',
                    status: 'success',
                    message: `‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: ${location.protocol}//${location.hostname}`
                });
            } else if (isLocalIP) {
                checks.push({
                    title: 'HTTPS –∏–ª–∏ localhost',
                    status: 'error',
                    message: `‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–π IP (${location.hostname}). –î–ª—è PWA –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å localhost –∏–ª–∏ HTTPS.`,
                    solution: `üí° –†–µ—à–µ–Ω–∏–µ: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –Ω–∞ localhost:\n` +
                             `   python3 -m http.server 8000\n` +
                             `   –ó–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:8000`
                });
            } else {
                checks.push({
                    title: 'HTTPS –∏–ª–∏ localhost',
                    status: 'error',
                    message: `‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è HTTPS –∏–ª–∏ localhost. –¢–µ–∫—É—â–∏–π: ${location.protocol}//${location.hostname}`
                });
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: Manifest.json
        async function checkManifest() {
            try {
                const response = await fetch('./manifest.json');
                if (!response.ok) throw new Error('–ù–µ –Ω–∞–π–¥–µ–Ω');
                
                const manifest = await response.json();
                const required = ['name', 'short_name', 'start_url', 'display', 'icons'];
                const missing = required.filter(key => !manifest[key]);
                
                if (missing.length > 0) {
                    checks.push({
                        title: 'Manifest.json',
                        status: 'error',
                        message: `‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: ${missing.join(', ')}`
                    });
                } else {
                    checks.push({
                        title: 'Manifest.json',
                        status: 'success',
                        message: `‚úÖ Manifest –∑–∞–≥—Ä—É–∂–µ–Ω. –ò–º—è: "${manifest.name}", Display: ${manifest.display}`
                    });
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∫–æ–Ω–æ–∫ –≤ manifest
                    if (manifest.icons && manifest.icons.length > 0) {
                        checks.push({
                            title: '–ò–∫–æ–Ω–∫–∏ –≤ manifest',
                            status: 'success',
                            message: `‚úÖ –ù–∞–π–¥–µ–Ω–æ ${manifest.icons.length} –∏–∫–æ–Ω–æ–∫ –≤ manifest`
                        });
                    } else {
                        checks.push({
                            title: '–ò–∫–æ–Ω–∫–∏ –≤ manifest',
                            status: 'error',
                            message: '‚ùå –ù–µ—Ç –∏–∫–æ–Ω–æ–∫ –≤ manifest.json'
                        });
                    }
                }
            } catch (error) {
                checks.push({
                    title: 'Manifest.json',
                    status: 'error',
                    message: `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ manifest.json: ${error.message}`
                });
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ò–∫–æ–Ω–∫–∏
        async function checkIcons() {
            const icons = ['icon-192.png', 'icon-512.png'];
            let found = 0;
            let missing = [];
            
            for (const icon of icons) {
                try {
                    const response = await fetch(`./${icon}`, { method: 'HEAD' });
                    if (response.ok) {
                        found++;
                    } else {
                        missing.push(icon);
                    }
                } catch (error) {
                    missing.push(icon);
                }
            }
            
            if (found === icons.length) {
                checks.push({
                    title: '–ò–∫–æ–Ω–∫–∏ —Ñ–∞–π–ª—ã',
                    status: 'success',
                    message: `‚úÖ –í—Å–µ –∏–∫–æ–Ω–∫–∏ –Ω–∞–π–¥–µ–Ω—ã (${found}/${icons.length})`
                });
            } else {
                checks.push({
                    title: '–ò–∫–æ–Ω–∫–∏ —Ñ–∞–π–ª—ã',
                    status: 'error',
                    message: `‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–∫–æ–Ω–∫–∏: ${missing.join(', ')}. –°–æ–∑–¥–∞–π—Ç–µ –∏—Ö —Å –ø–æ–º–æ—â—å—é create-icons-simple.html`
                });
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: Service Worker
        async function checkServiceWorker() {
            if ('serviceWorker' in navigator) {
                checks.push({
                    title: 'Service Worker –ø–æ–¥–¥–µ—Ä–∂–∫–∞',
                    status: 'success',
                    message: '‚úÖ –ë—Ä–∞—É–∑–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Service Worker'
                });
                
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        checks.push({
                            title: 'Service Worker —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',
                            status: 'success',
                            message: `‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. Scope: ${registration.scope}`
                        });
                        
                        if (registration.active) {
                            checks.push({
                                title: 'Service Worker —Å—Ç–∞—Ç—É—Å',
                                status: 'success',
                                message: `‚úÖ Service Worker –∞–∫—Ç–∏–≤–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç`
                            });
                        } else if (registration.installing) {
                            checks.push({
                                title: 'Service Worker —Å—Ç–∞—Ç—É—Å',
                                status: 'warning',
                                message: `‚ö†Ô∏è Service Worker —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è...`
                            });
                        } else if (registration.waiting) {
                            checks.push({
                                title: 'Service Worker —Å—Ç–∞—Ç—É—Å',
                                status: 'warning',
                                message: `‚ö†Ô∏è Service Worker –æ–∂–∏–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏`
                            });
                        }
                    } else {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –ª–∏ –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
                        try {
                            const testReg = await navigator.serviceWorker.register('./service-worker.js', { scope: './' });
                            checks.push({
                                title: 'Service Worker —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',
                                status: 'warning',
                                message: '‚ö†Ô∏è Service Worker –Ω–µ –±—ã–ª –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ app.js'
                            });
                        } catch (regError) {
                            checks.push({
                                title: 'Service Worker —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',
                                status: 'error',
                                message: `‚ùå Service Worker –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –û—à–∏–±–∫–∞: ${regError.message}`
                            });
                        }
                    }
                } catch (error) {
                    checks.push({
                        title: 'Service Worker',
                        status: 'error',
                        message: `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ Service Worker: ${error.message}`
                    });
                }
            } else {
                checks.push({
                    title: 'Service Worker –ø–æ–¥–¥–µ—Ä–∂–∫–∞',
                    status: 'error',
                    message: '‚ùå Service Worker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ Chrome, Edge –∏–ª–∏ Firefox'
                });
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 5: beforeinstallprompt
        function checkInstallPrompt() {
            let deferredPrompt = null;
            window.addEventListener('beforeinstallprompt', (e) => {
                deferredPrompt = e;
            });
            
            setTimeout(() => {
                if (deferredPrompt) {
                    checks.push({
                        title: '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ PWA',
                        status: 'success',
                        message: '‚úÖ –ë—Ä–∞—É–∑–µ—Ä –≥–æ—Ç–æ–≤ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ PWA (beforeinstallprompt —Å—Ä–∞–±–æ—Ç–∞–ª)'
                    });
                } else {
                    checks.push({
                        title: '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ PWA',
                        status: 'warning',
                        message: '‚ö†Ô∏è beforeinstallprompt –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã: —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –Ω–µ –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –∏–ª–∏ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç'
                    });
                }
            }, 2000);
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 6: –£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ?
        function checkInstalled() {
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            const isIOSStandalone = window.navigator.standalone === true;
            
            if (isStandalone || isIOSStandalone) {
                checks.push({
                    title: '–°—Ç–∞—Ç—É—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏',
                    status: 'success',
                    message: '‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∫–∞–∫ PWA!'
                });
            } else {
                checks.push({
                    title: '–°—Ç–∞—Ç—É—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏',
                    status: 'warning',
                    message: '‚ÑπÔ∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏'
                });
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function displayChecks() {
            const container = document.getElementById('checks');
            container.innerHTML = '';
            
            checks.forEach(check => {
                const div = document.createElement('div');
                div.className = `check-item ${check.status}`;
                let html = `
                    <h3>${check.title}</h3>
                    <p>${check.message}</p>
                `;
                if (check.solution) {
                    html += `<p style="margin-top: 10px; font-weight: bold; white-space: pre-line;">${check.solution}</p>`;
                }
                div.innerHTML = html;
                container.appendChild(div);
            });
        }
        
        // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
        async function runChecks() {
            checkHTTPS();
            checkInstalled();
            await checkManifest();
            await checkIcons();
            await checkServiceWorker();
            checkInstallPrompt();
            
            setTimeout(displayChecks, 500);
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        runChecks();
    </script>
</body>
</html>
